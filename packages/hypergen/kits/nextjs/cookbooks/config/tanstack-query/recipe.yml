name: tanstack-query
description: |
  Setup TanStack Query (React Query) for server state management.
  Includes provider setup, devtools, and example query hooks.
version: 1.0.0

variables:
  withDevtools:
    type: boolean
    description: Install React Query Devtools for debugging
    default: true

  withPersister:
    type: boolean
    description: Setup persist query client (for offline support)
    default: false

steps:
  - name: Install TanStack Query
    tool: shell
    command: |
      if command -v bun &> /dev/null; then
        bun add @tanstack/react-query
        @if(withDevtools)
bun add -d @tanstack/react-query-devtools@end

        @if(withPersister)
bun add @tanstack/react-query-persist-client@end

      elif command -v pnpm &> /dev/null; then
        pnpm add @tanstack/react-query
        @if(withDevtools)
pnpm add -D @tanstack/react-query-devtools@end

        @if(withPersister)
pnpm add @tanstack/react-query-persist-client@end

      elif command -v yarn &> /dev/null; then
        yarn add @tanstack/react-query
        @if(withDevtools)
yarn add -D @tanstack/react-query-devtools@end

        @if(withPersister)
yarn add @tanstack/react-query-persist-client@end

      else
        npm install @tanstack/react-query
        @if(withDevtools)
npm install -D @tanstack/react-query-devtools@end

        @if(withPersister)
npm install @tanstack/react-query-persist-client@end

      fi

  - name: Create Query Provider
    tool: template
    template: templates/query-provider.tsx.jig

  - name: Create query client configuration
    tool: template
    template: templates/query-client.ts.jig

  - name: Create example query hook
    tool: template
    template: templates/example-query-hook.ts.jig

  - name: Create example mutation hook
    tool: template
    template: templates/example-mutation-hook.ts.jig

  - name: Update root layout
    tool: shell
    command: |
      echo ""
      echo "⚠️  MANUAL STEP REQUIRED:"
      echo ""
      echo "Add QueryProvider to your root layout:"
      echo ""
      echo "// app/layout.tsx"
      echo "import { QueryProvider } from '@/components/providers/query-provider'"
      echo ""
      echo "export default function RootLayout({ children }) {"
      echo "  return ("
      echo "    <html>"
      echo "      <body>"
      echo "        <QueryProvider>{children}</QueryProvider>"
      echo "      </body>"
      echo "    </html>"
      echo "  )"
      echo "}"

  - name: Instructions
    tool: shell
    command: |
      echo "✅ TanStack Query initialized successfully!"
      echo ""
      echo "Created files:"
      echo "  - components/providers/query-provider.tsx"
      echo "  - lib/query-client.ts"
      echo "  - hooks/use-example-query.ts"
      echo "  - hooks/use-example-mutation.ts"
      echo ""
      echo "Next steps:"
      echo "  1. Add <QueryProvider> to your root layout (see above)"
      echo "  2. Create query hooks in hooks/ directory"
      echo "  3. Use hooks in your components"
      @if(withDevtools)
echo "  4. Open React Query Devtools (bottom-left corner in dev mode)"@end

      echo ""
      echo "Example usage:"
      echo "  import { useExampleQuery } from '@/hooks/use-example-query'"
      echo ""
      echo "  export function MyComponent() {"
      echo "    const { data, isLoading } = useExampleQuery()"
      echo "    // ..."
      echo "  }"

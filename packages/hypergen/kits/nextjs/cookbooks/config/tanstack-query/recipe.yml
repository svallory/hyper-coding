name: tanstack-query
description: |
  Setup TanStack Query (React Query) for server state management.
  Includes provider setup, devtools, and example query hooks.
version: 1.0.0

variables:
  withDevtools:
    type: boolean
    description: Install React Query Devtools for debugging
    default: true

  withPersister:
    type: boolean
    description: Setup persist query client (for offline support)
    default: false

steps:
  - name: Install TanStack React Query
    tool: install
    packages: ["@tanstack/react-query"]

  - name: Install devtools
    tool: install
    packages: ["@tanstack/react-query-devtools"]
    dev: true
    when: "withDevtools === true"

  - name: Install persister
    tool: install
    packages: ["@tanstack/react-query-persist-client"]
    when: "withPersister === true"

  - name: Create Query Provider
    tool: template
    template: templates/query-provider.tsx.jig

  - name: Create query client configuration
    tool: template
    template: templates/query-client.ts.jig

  - name: Create example query hook
    tool: template
    template: templates/example-query-hook.ts.jig

  - name: Create example mutation hook
    tool: template
    template: templates/example-mutation-hook.ts.jig

onSuccess: |
  MANUAL STEP REQUIRED:

  Add QueryProvider to your root layout:

  // app/layout.tsx
  import { QueryProvider } from '@/components/providers/query-provider'

  export default function RootLayout({ children }) {
    return (
      <html>
        <body>
          <QueryProvider>{children}</QueryProvider>
        </body>
      </html>
    )
  }

  TanStack Query initialized successfully!

  Created files:
    - components/providers/query-provider.tsx
    - lib/query-client.ts
    - hooks/use-example-query.ts
    - hooks/use-example-mutation.ts

  Next steps:
    1. Add <QueryProvider> to your root layout (see above)
    2. Create query hooks in hooks/ directory
    3. Use hooks in your components
  @if(withDevtools)
    4. Open React Query Devtools (bottom-left corner in dev mode)
  @end

  Example usage:
    import { useExampleQuery } from '@/hooks/use-example-query'

    export function MyComponent() {
      const { data, isLoading } = useExampleQuery()
      // ...
    }

name: prisma
description: |
  Initialize Prisma ORM in a Next.js project.
  Sets up Prisma schema, client, and database connection.
version: 1.0.0

variables:
  database:
    type: enum
    description: Database provider
    values: [postgresql, mysql, sqlite, mongodb, cockroachdb]
    default: postgresql

  databaseUrl:
    type: string
    description: Database connection URL (optional, can be set in .env later)
    required: false

steps:
  - name: Install Prisma CLI
    tool: install
    packages: [prisma]
    dev: true

  - name: Install Prisma Client
    tool: install
    packages: ["@prisma/client"]

  - name: Initialize Prisma
    tool: shell
    command: npx prisma init --datasource-provider {{ database }}

  - name: Create Prisma client singleton
    tool: template
    template: templates/prisma-client.ts.jig

  - name: Create example model
    tool: template
    template: templates/example-schema.prisma.jig

  - name: Update .env with database URL
    tool: shell
    command: |
      if [ ! -f .env ]; then
        echo "Creating .env file..."
        touch .env
      fi
      if ! grep -q "DATABASE_URL" .env; then
        echo "" >> .env
        echo "# Database" >> .env
        @if(databaseUrl)
          echo "DATABASE_URL=\"{{ databaseUrl }}\"" >> .env
        @else if(database === 'postgresql')
          echo "DATABASE_URL=\"postgresql://user:password@localhost:5432/mydb\"" >> .env
        @else if(database === 'mysql')
          echo "DATABASE_URL=\"mysql://user:password@localhost:3306/mydb\"" >> .env
        @else if(database === 'sqlite')
          echo "DATABASE_URL=\"file:./dev.db\"" >> .env
        @else if(database === 'mongodb')
          echo "DATABASE_URL=\"mongodb://localhost:27017/mydb\"" >> .env
        @end
      fi

onSuccess: |
  Prisma initialized successfully!

  Next steps:
    1. Update DATABASE_URL in .env with your database credentials
    2. Edit prisma/schema.prisma to define your data models
    3. Run 'npx prisma migrate dev --name init' to create your database
    4. Import Prisma client: import { prisma } from '@/lib/prisma'

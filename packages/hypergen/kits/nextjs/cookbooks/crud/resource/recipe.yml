name: resource
description: |
  Generate a complete full-stack CRUD resource by orchestrating all granular recipes.
  This flagship "meta-recipe" calls list-page, detail-page, create-page, edit-page, and delete recipes.

  Generated files (8-12 depending on ORM):
  - List page with data table (sorting, filtering, pagination)
  - Detail view page with delete dialog
  - Create page with form
  - Edit page with pre-filled form
  - All Server Actions (list, create, read, update, delete)
  - Zod validation schema
  - Reusable table and form components

  Time saved: 60-120 min â†’ 5 min (12-24x faster)

version: 2.0.0

variables:
  name:
    type: string
    description: Resource name (singular, e.g., 'post', 'user', 'product')
    required: true
    position: 0
    prompt: What is the resource name? (singular, e.g., 'post', 'user')

  model:
    type: string
    description: Model name (PascalCase, defaults to capitalized name)
    required: false

  fields:
    type: string
    description: Comma-separated fields with types (e.g., "title:string,content:text,published:boolean")
    required: false
    prompt: |
      Enter fields (comma-separated, format: name:type)
      Leave empty to auto-detect from Prisma/Drizzle schema
      Example: title:string,content:text,published:boolean

  pages:
    type: enum
    multiple: true
    values: ['list', 'detail', 'create', 'edit']
    default: ['list', 'detail', 'create', 'edit']
    description: Which pages to generate (AI can override when --ask=ai)

  useServerActions:
    type: boolean
    description: Use Server Actions instead of API routes
    default: true

  includePagination:
    type: boolean
    description: Include pagination in list view
    default: true

  includeSorting:
    type: boolean
    description: Include sorting in data table
    default: true

  includeFiltering:
    type: boolean
    description: Include filtering in data table
    default: true

  includeDelete:
    type: boolean
    description: Include delete functionality with confirmation dialog
    default: true

steps:
  - name: Generate list page with data table
    tool: recipe
    recipe: ../list-page
    when: "pages.includes('list')"
    args:
      name: "{{ name }}"
      model: "{{ model }}"
      fields: "{{ fields }}"
      includePagination: "{{ includePagination }}"
      includeSorting: "{{ includeSorting }}"
      includeFiltering: "{{ includeFiltering }}"

  - name: Generate detail page
    tool: recipe
    recipe: ../detail-page
    when: "pages.includes('detail')"
    args:
      name: "{{ name }}"
      model: "{{ model }}"
      includeDelete: "{{ includeDelete }}"

  - name: Generate create page with form
    tool: recipe
    recipe: ../create-page
    when: "pages.includes('create')"
    args:
      name: "{{ name }}"
      model: "{{ model }}"
      fields: "{{ fields }}"

  - name: Generate edit page
    tool: recipe
    recipe: ../edit-page
    when: "pages.includes('edit')"
    args:
      name: "{{ name }}"
      model: "{{ model }}"
      fields: "{{ fields }}"

  - name: Install dependencies if needed
    tool: shell
    command: |
      # Check if zod is installed
      if ! grep -q '"zod"' package.json; then
        echo "Installing zod..."
        if command -v bun &> /dev/null; then
          bun add zod
        elif command -v pnpm &> /dev/null; then
          pnpm add zod
        elif command -v yarn &> /dev/null; then
          yarn add zod
        else
          npm install zod
        fi
      fi

      # Check if react-hook-form is installed
      if ! grep -q '"react-hook-form"' package.json; then
        echo "Installing react-hook-form..."
        if command -v bun &> /dev/null; then
          bun add react-hook-form @hookform/resolvers
        elif command -v pnpm &> /dev/null; then
          pnpm add react-hook-form @hookform/resolvers
        elif command -v yarn &> /dev/null; then
          yarn add react-hook-form @hookform/resolvers
        else
          npm install react-hook-form @hookform/resolvers
        fi
      fi

  - name: Success message
    tool: shell
    command: |
      echo "âœ… Complete CRUD resource '{{ name }}' generated successfully!"
      echo ""
      echo "This meta-recipe orchestrated 4 granular recipes:"
      echo "  1. list-page - List view with data table"
      echo "  2. detail-page - Detail view with actions"
      echo "  3. create-page - Create form with validation"
      echo "  4. edit-page - Edit form with pre-fill"
      echo ""
      echo "Generated files:"
      echo "  ğŸ“„ app/{{ name }}/page.tsx - List view"
      echo "  ğŸ“„ app/{{ name }}/[id]/page.tsx - Detail view"
      echo "  ğŸ“„ app/{{ name }}/[id]/edit/page.tsx - Edit page"
      echo "  ğŸ“„ app/{{ name }}/new/page.tsx - Create page"
      echo "  ğŸ“¦ components/{{ model || name }}Table.tsx - Data table"
      echo "  ğŸ“ components/{{ model || name }}Form.tsx - Create/edit form"
      @if(includeDelete)
      echo "  ğŸ—‘ï¸  components/{{ model || name }}DeleteDialog.tsx - Delete confirmation"
      @end
      echo "  âš¡ app/actions/{{ name }}.ts - All CRUD Server Actions"
      echo "  âœ… lib/schemas/{{ name }}-schema.ts - Validation"
      echo ""
      echo "Next steps:"
      echo "  1. Review and customize the generated files"
      @if(fields)
      echo "  2. Update your database schema and run migrations"
      @else
      echo "  2. Make sure your database model matches the schema"
      @end
      echo "  3. Visit /{{ name }} to see your CRUD interface"
      echo ""
      echo "Time saved: ~90 minutes ğŸ‰"

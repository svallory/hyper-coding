---
to: "{{ name }}/tests/kit.test.ts"
---
import { describe, it, expect } from 'bun:test';
import { execSync } from 'child_process';
import path from 'path';

describe('{{ name }} kit', () => {
  it('should run the create recipe in sandbox', () => {
    const sandboxPath = path.join(__dirname, '../sandbox');
    // Ensure sandbox exists
    execSync(`mkdir -p ${sandboxPath}`);
    
    // This assumes hyper command is available or linked. Adjust path as needed.
    // For local dev, likely invoking the bin directly.
    const binPath = '../../../../dist/bin.js'; // Adjust relative path to hypergen bin
    
    try {
        const output = execSync(`bun ${binPath} recipe execute ../cookbooks/create/recipe.yml`, {
            cwd: sandboxPath,
            encoding: 'utf-8'
        });
        console.log(output);
        expect(output).toContain('Hello from {{ name }} kit');
    } catch (e) {
        console.error(e.stdout);
        console.error(e.stderr);
        throw e;
    }
  });
});

$schema: "https://moonrepo.dev/schemas/tasks.json"

implicitDeps:
  - "^:build"

implicitInputs:
  - "package.json"
  - "tsconfig.json"
  - "biome.json"
  - ".biomerc*"

fileGroups:
  # Source files
  sources:
    - "src/**/*"
    - "types/**/*"

  # Test files
  tests:
    - "tests/**/*.test.*"
    - "tests/**/*.spec.*"
    - "**/__tests__/**/*"

  # Configuration files
  configs:
    - "*.config.*"
    - ".eslintrc.*"
    - ".prettierrc*"
    - "tsconfig*.json"

tasks:
  # Build with tsup
  build:
    description: Build library/package with tsup
    command: "tsup"
    inputs:
      - "@globs(sources)"
      - "@globs(configs)"
      - "package.json"
    outputs:
      - "dist"

  # Format check with biome check
  format:
    description: Check code formatting with biome
    command: "biome check ."
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"
      - "**/*.md"

  # Format and write with biome
  format-write:
    description: Format code with biome
    command: "biome format . --write"
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"
      - "**/*.md"
    options:
      cache: local

  # Lint with biome
  lint:
    description: Lint code with biome
    command: "biome check . --apply"
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"

  # Test with vitest
  test:
    description: Run tests with vitest
    command: "vitest run"
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "vitest.config.*"

  # Watch tests with vitest
  test-watch:
    description: Run tests in watch mode with vitest
    command: "vitest"
    options:
      cache: local

  # Typecheck with tsc
  typecheck:
    description: Check TypeScript types
    command: "tsc --noEmit"
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"
